name: Java CI with Maven

on:
  pull_request:
    branches: [ "release-*" ]

permissions:
  actions: read
  contents: write

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository   
        uses: actions/checkout@v6
        
      
      - name: Set up JDK 25
        uses: actions/setup-java@v5
        with:
          distribution: 'temurin' # See 'Supported distributions' for available options
          java-version: '25'
  
          cache: maven
          server-id: nexus-releases
          server-username: NEXUS_USERNAME
          server-password: NEXUS_PASSWORD
        env:
          NEXUS_USERNAME: ${{ secrets.NEXUS_USERNAME }}
          NEXUS_PASSWORD: ${{ secrets.NEXUS_PASSWORD }}

      - name: Build
        run: dotnet build --configuration Release
        
      - name: Test
        run: dotnet test --logger "trx;LogFileName=test-results.trx" || true
        
      - name: Test Report
        uses: dorny/test-reporter@v1
        if: always()
        with:
          name: DotNET Tests
          path: "**/test-results.trx"                            
          reporter: dotnet-trx
          fail-on-error: true

          
      # - name: Run Tests and Generate JaCoCo Report
      #   run: mvn -B clean test    

      # - name: Unit & Integration Tests (JUnit)
      #   run: mvn verify -DskipUnitTests=false # 'verify' runs both unit (surefire) and integration (failsafe) tests

      # - name: Code Coverage (JaCoCo)
      #   run: mvn jacoco:report

      # - name: Upload Test Results
      #   if: always()
      #   uses: actions/upload-artifact@v4
      #   with:
      #     name: test-reports
      #     path: target/surefire-reports/  
